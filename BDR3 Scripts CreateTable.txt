create database erronka3 CHARACTER SET utf8 COLLATE utf8_general_ci;
use erronka3;

create table Productos(
IDProducto integer primary key AUTO_INCREMENT,
PrecioCompraProd float not null constraint PrecioCompraProd check (PrecioCompraProd > 0),
FechaCad date not null,
TipoProd varchar(25) not null,
NomProd varchar(20) not null,
PrecioVentaProd float not null constraint PrecioVentaProd check (PrecioVentaProd > 0) not null
);

create table Local(
NIF char(9) primary key,
TipoDeNegocio enum ('Bar','Cafeteria','Restaurante') not null,
NIFTrabajador char(9),
Nombre varchar(20) not null,
Direccion varchar(40) not null,
NombreProp varchar(20) not null
);

create table Tiene(
NIF char(9) ,
IDProducto integer auto_increment,
StockProd integer not null constraint StockProd check (StockProd > 0),
constraint PK_Tiene primary key (NIF,IDProducto),
constraint FK_TieneIDProducto foreign key (IDProducto) references Productos(IDProducto),
constraint FK_TieneNIF foreign key (NIF) references Local(NIF)
);

create table operaciones(
IDOperaciones integer primary key auto_increment,
TotOperaciones integer not null,
PrecioTotalOp float not null,
NIF char(9) not null,
constraint FK_OperacionesNIF foreign key (NIF) references Local(NIF)
);

create table Aparecen(
ID integer ,
IDProducto integer ,
NumUniPorProd integer not null constraint NumUniPorProd check (NumUniPorProd > 0),
PrecioPorUnidad float not null constraint PrecioPorUnidad check (PrecioPorUnidad > 0),
PrecioTotPorProd float not null constraint PrecioTotPorProd check (PrecioTotPorProd > 0),
constraint PK_Aparecen primary key (ID, IDProducto),
constraint FK_AparecenID foreign key (ID) references Operaciones(IDOperaciones),
constraint FK_AparecenIDProducto foreign key (IDProducto) references Productos(IDProducto)
);

create table pedido(
ID integer primary key,
DomicilioSioNo enum ('Si','No') not null,
DirDomicilio varchar(50) not null,
constraint FK_PedidoID foreign key (ID) references Operaciones(IDOperaciones)
);

create table Factura(
ID integer not null,
NIF char(9)  primary key,
constraint FK_FacturaID foreign key (ID) references Operaciones(IDOperaciones)
);

create table DesFactura(
NIF char(9) primary key,
NomDes varchar(20) not null,
DirDes varchar (20),
constraint FK_DesFacturaNIF foreign key (NIF) references Factura(NIF)
);

Create table aprovisionamiento(
ID integer primary key,
constraint FK_AprovisionamientoID foreign key (ID) references Operaciones(IDOperaciones)
);

create table fabricante(
nombre varchar(25) primary key,
tiempo  date not null,
stock integer not null constraint Stock check (Stock > 0),
ID integer,
IDProducto integer,
constraint FK_FabricanteID foreign key (ID) references Aprovisionamiento(ID),
constraint FK_FabricanteIDProducto foreign key (IDProducto) references Productos(IDProducto)
);

create table comandas(
ID integer primary key,
Codigo integer not null,
constraint FK_ComandaID foreign key (ID) references Operaciones(IDOperaciones)
);

create table Platos(
Codigo integer auto_increment primary key,
Tipo enum ('Primer Plato','Segundo Plato','Postre') not null,
Nombre varchar(25) not null
);

create table Contiene(
CodPlatos integer,
CodComandas integer,
Cantidad integer not null constraint cantidad check (cantidad > 0),
PrecioDeVenta float not null constraint PrecioDeVenta check (PrecioDeVenta > 0),
constraint PK_Contiene primary key (CodPlatos, CodComandas),
constraint FK_ContieneCodPlatos foreign key (CodPlatos) references Platos(Codigo),
constraint FK_ContieneCodComandas foreign key (CodComandas) references Comandas(ID)
);

create table ingredientes(
Nombre varchar(50) primary key,
FrutosSecos enum ('Si','No') default 'No',
Marisco enum ('Si','No') default 'No',
Gluten enum ('Si','No') default 'No',
Vegetariano enum ('Si','No') default 'No',
Vegano enum ('Si','No') default 'No'
);

create table Conforman(
CodPlatos integer,
Nombrecon varchar(50),
constraint PK_Conforman primary key (CodPlatos, Nombrecon),
constraint FK_ConformanCodplatos foreign key (Codplatos) references Platos(Codigo),
constraint FK_ConformanNombrecon foreign key (Nombrecon) references Ingredientes(Nombre)
);

create table Usuarios(
Usuario char(9) primary key,
Contrase√±a varchar(16) not null
);

Alter table local
add constraint FK_LocalNIFTrabajador foreign key (NIFTrabajador) references Usuarios(Usuario);